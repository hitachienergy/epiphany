---
# Docker (used by image_registry)
- name: Include containerd defauts
  include_vars:
    file: roles/containerd/defaults/main.yml
    name: containerd_defaults

- name: Install Docker packages
  package:
    name: "{{ _packages[ansible_os_family] }}"
    state: present
  vars:
    _packages:
      Debian:
        - containerd.io={{ containerd_defaults.containerd_version }}-*
        - docker-ce-cli={{ docker_version.Debian }}
        - docker-ce-rootless-extras={{ docker_version.Debian }}
        - docker-ce={{ docker_version.Debian }}
      RedHat:
        - containerd.io-{{ containerd_defaults.containerd_version }}
        - docker-ce-cli-{{ docker_version.RedHat }}
        - docker-ce-rootless-extras-{{ docker_version.RedHat }}
        - docker-ce-{{ docker_version.RedHat }}
  module_defaults:
    yum: {lock_timeout: "{{ yum_lock_timeout }}"}

- include_tasks: configure-docker.yml
