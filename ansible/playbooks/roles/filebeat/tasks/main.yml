---
- name: Include installation tasks for Filebeat as OS service for "classic epiphany cluster"
  include_tasks: install-filebeat-as-system-service.yml

- name: Load variables from opensearch role  # needed to get passwords for both installation types
  include_vars:
    file: roles/opensearch/vars/main.yml
    name: opensearch_vars
  when: groups.opensearch is defined

- name: Include installation tasks for Filebeat as DaemonSet for "k8s as cloud service"
  include_tasks: install-filebeat-as-daemonset.yml
  when:
    - k8s_as_cloud_service is defined
    - k8s_as_cloud_service
    - groups.opensearch is defined
    - groups.opensearch | length > 0

- name: Include auditd configuration tasks
  include_tasks: configure-auditd.yml

- name: Include filebeat configuration tasks
  include_tasks: configure-filebeat.yml
