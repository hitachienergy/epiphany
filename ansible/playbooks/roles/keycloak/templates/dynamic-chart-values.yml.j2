#jinja2: lstrip_blocks: True

# Keep data structure in sync with Helm chart's values.
# ref: https://raw.githubusercontent.com/codecentric/helm-charts/keycloakx-1.6.0/charts/keycloakx/values.yaml

{% if specification.image_registry.use_local %}
image:
  repository: {{ image_registry_address }}/{{ _chart_values.image.repository }}
{% else %}
image:
  repository: {{ _chart_values.image.repository }}
{% endif %}

{% if specification.database.epiphany_managed and _chart_values.database.hostname | lower == 'autoconfigured' %}
database:
  {% if groups.postgresql | count == 1 %}
  hostname: {{ hostvars[groups.postgresql[0]].ansible_default_ipv4.address }}
  {% else %}
  hostname: {{ applications_vars.specification.applications | selectattr('name', '==', 'pgbouncer') | first).pgbouncer.env.DB_HOST }}
  {% endif %}
{% endif %}
