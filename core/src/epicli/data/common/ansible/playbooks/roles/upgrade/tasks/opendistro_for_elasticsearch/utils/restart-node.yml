---
# required vars:
# - es_transport_port
# - es_http_port
# - target_inventory_hostname
# - hostvars[target_inventory_hostname].es_host

# optional vars:
# - daemon_reload
# - expected_status [ green, yellow ] (type: list)
# - skip_waiting_for_status

- name: ODFE | Restart elasticsearch service
  systemd:
    name: elasticsearch
    state: restarted
    daemon_reload: "{{ daemon_reload | default(omit) }}"

- name: ODFE | Wait for elasticsearch node to come back up
  wait_for:
    port: "{{ es_transport_port }}"
    host: "{{ hostvars[target_inventory_hostname].es_host }}"

- name: ODFE | Wait for elasticsearch http to come back up
  wait_for:
    port: "{{ es_http_port }}"
    host: "{{ hostvars[target_inventory_hostname].es_host }}"

- include_tasks: wait-for-cluster-status.yml
  when: not (skip_waiting_for_status | default(False))
