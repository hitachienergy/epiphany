---
# required vars:
# - es_api.url
# - es_api.cert_path
# - es_api.key_path
# - expected_status (type: list, e.g. [ 'green', 'yellow' ])

- name: ODFE | Wait for '{{ expected_status | join("' or '") }}' cluster health status
  uri:
    url: "{{ es_api.url }}/_cluster/health"
    client_cert: "{{ es_api.cert_path }}"
    client_key:  "{{ es_api.key_path }}"
    method: GET
    validate_certs: false
  register: cluster_health
  until:
    - cluster_health.json.status is defined
    - cluster_health.json.status in expected_status
  retries: 120
  delay: 1
