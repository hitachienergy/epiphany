---
# required vars:
# - es_api.url
# - es_api.cert_path
# - es_api.key_path

# optional vars:
# - expected_status [ green, yellow ] (type: list)

- name: ODFE | Wait for '{{ _expected_status | join("' or '") }}' cluster health status
  uri:
    url: "{{ es_api.url }}/_cluster/health"
    method: GET
    client_cert: "{{ es_api.cert_path }}"
    client_key:  "{{ es_api.key_path }}"
    validate_certs: false
  register: cluster_health
  until:
    - cluster_health.json.status is defined
    - cluster_health.json.status in _expected_status
  retries: 120
  delay: 1
  vars:
    _expected_status: "{{ expected_status | default(['green', 'yellow']) }}"
